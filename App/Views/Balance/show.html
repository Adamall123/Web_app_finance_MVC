{% extends "base.html" %}

{% block title %}Balance{% endblock %}


{% block footer %}
<script>
       
    $( document ).ready(function() {
       
        $("#dateCategory").on('change', function(){
            var date_id = $(this).val(); 
            $.ajax({
                type: "POST",
                url: "/balance/change",
                data: {date_id: date_id},
                dataType:'JSON', 
                success: function(response){
                       var container = $('')
                       var $resultIncomes ='';
                       var $resultExpenses ='';
                       var $resultSumFromIncomesAndExpences ='';
                       $.each(response.allIncomesOfUser, function (i, val) {
                           container.append(val)
                           $resultIncomes += "<li>" + val['name'] + " : " + val['sum'] + "</li>";
                       })
                       $('#incomes').html($resultIncomes);
                       $.each(response.allExpensesOfUser, function (i, val) {
                           container.append(val)
                           $resultExpenses += "<li>" + val['name'] + " : " + val['sum'] + "</li>";
                       })
                       $('#expenses').html($resultExpenses);
                       if(response.sumFromIncomesAndExpenses > 0) {
                           $resultSumFromIncomesAndExpences = "<div id='balanceWindow'><h5>Your balance is: " + response.sumFromIncomesAndExpenses + " zł<br><div class='line'> Well done! </h5></div></div>" ; 
                       } else {
                          $resultSumFromIncomesAndExpences = "<div id='balanceWindow' style='background-color:#cc7a00'><h5>Your balance is: " + response.sumFromIncomesAndExpenses + " zł<br><div class='line'> Try to get better incomes or spend less money on expenses. </h5></div></div>" ;
                       }
                       $('#balance').html($resultSumFromIncomesAndExpences);
                }
            }); 
			}); 
        });
 </script>
{% endblock %}
   
{% block body %}
   <h1>Balance</h1>

   <main>
    <div class="container">
		<div id="setDateRangeForm">
		<i class="far fa-calendar-check"></i><span style="font-size: 20px;"> Set date range of your transactions:</span>
		<div class="line"> </div>        
		<div class="box">
            <form method="post" action="/balance/show" name="dateCategory">
                <select name="dateCategory" id="dateCategory"   {# onchange="this.form.submit();" #}>  
                    <option value="1">Current Month </option> 
                    <option value="2">Last Month </option>  
                    <option value="3">This year </option>  
                    <option value="4">Total Time </option>  
                 </select> 
            </form>
			
		</div>
		</div>
			<div class="row">
				<div class="col-lg-6">
					<div class="Category">
						<header>
							<div class="CategoryHeader"><h4>Incomes</h4></div>
						</header>
							<div class="CategoryColumn">
								<ul class="CategoryRow" id="incomes">
                                    {% for allIncomeOfUser in allIncomesOfUser %}
                                    <li>{{ allIncomeOfUser['name'] }}: {{ allIncomeOfUser['sum'] }}</li>
                                    {% endfor %}
								</ul>
							</div>
						</div>
				</div>
                <div class="col-lg-6">
                    <div class="Category">
                       <header>
                           <div class="CategoryHeader"><h4>Expences</h4></div>
                       </header>
                            <div class="CategoryColumn">
                                <ul class="CategoryRow" id="expenses">
                                    {% for allExpenseOfUser in allExpensesOfUser %}
                                    <li>{{ allExpenseOfUser['name'] }}: {{ allExpenseOfUser['sum'] }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                   </div>
               </div>  
			</div>
        <div style="clear: both;"></div>
        <div id="balance">
             {% if sumFromIncomesAndExpenses >= 0 %}
                <div id="balanceWindow">
                    <h5>Your balance is: {{ sumFromIncomesAndExpenses }} zł
                    <br>
                    <div class="line"> Welll done! </h5> </div>
                </div>
                {% else %}
                <div id="balanceWindow" style="background-color:#cc7a00">
                    <h5>Your balance is: {{ sumFromIncomesAndExpenses }} zł
                    <br>
                    <div class="line"> Try to get better incomes or spend less money on expenses. </h5> </div>
                </div>
            {% endif %}
		</div>
	</div>
	</main>
{% endblock %}

